<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Prescription - {{ prescription.appointment.patient.get_full_name }}</title>
    <style>
        @page {
            size: A4;
            margin: 1cm;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12pt;
            line-height: 1.6;
            color: #000;
            margin: 0;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            border-bottom: 3px solid #007bff;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .header h1 {
            margin: 0;
            color: #007bff;
            font-size: 24pt;
        }
        
        .header p {
            margin: 5px 0;
            color: #666;
        }
        
        .patient-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .patient-info table {
            width: 100%;
        }
        
        .patient-info td {
            padding: 5px;
        }
        
        .section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 14pt;
            font-weight: bold;
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
            margin-bottom: 10px;
        }
        
        .medicine-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .medicine-table th,
        .medicine-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }
        
        .medicine-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }
        
        .medicine-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .signature {
            margin-top: 50px;
            text-align: right;
        }
        
        .signature-line {
            border-top: 2px solid #000;
            width: 250px;
            float: right;
            margin-top: 40px;
        }
        
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 10pt;
            color: #666;
            padding: 10px;
            border-top: 1px solid #ddd;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            background: #dc3545;
            color: white;
            border-radius: 3px;
            font-size: 10pt;
        }
        
        .alert-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        
        @media print {
            body {
                padding: 0;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üè• UNIVERSAL HEALTH SERVICES & DIAGNOSTIC CENTER</h1>
        <h2 style="margin: 5px 0; font-size: 18pt; color: #28a745;">‡¶á‡¶â‡¶®‡¶ø‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶æ‡¶≤ ‡¶π‡ßá‡¶≤‡¶• ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∏ ‡¶è‡¶®‡ßç‡¶° ‡¶°‡¶æ‡¶Ø‡¶º‡¶æ‡¶ó‡¶®‡¶∏‡ßç‡¶ü‡¶ø‡¶ï ‡¶∏‡ßá‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h2>
        <p style="font-weight: 600;">‡¶∏‡¶æ‡¶¶‡¶ø‡¶Ø‡¶º‡¶æ ‡¶™‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶∏, ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶∞‡ßã‡¶°, ‡¶®‡¶ú‡¶ø‡¶™‡ßÅ‡¶∞ ‡¶∏‡¶∞‡¶¶‡¶æ‡¶∞‡¶™‡¶æ‡¶°‡¶º‡¶æ ‡¶Æ‡ßã‡¶°‡¶º, ‡¶®‡¶ú‡¶ø‡¶™‡ßÅ‡¶∞ ‡¶™‡ßå‡¶∞‡¶∏‡¶¶, ‡¶™‡¶§‡ßç‡¶®‡ßÄ‡¶§‡¶≤‡¶æ, ‡¶®‡¶ì‡¶ó‡¶æ‡¶Å‡•§</p>
        <p><strong>Phone:</strong> ‡ß¶‡ßß‡ß≠‡ß©‡ß®-‡ßÆ‡ß´‡ß©‡ß©‡ß¶‡ß© | <strong>Email:</strong> info@universalhealth.com</p>
    </div>
    
    <!-- Patient Information -->
    <div class="patient-info">
        <table>
            <tr>
                <td width="50%">
                    <strong>Patient Name:</strong> {{ prescription.appointment.patient.get_full_name }}<br>
                    <strong>Patient ID:</strong> {{ prescription.appointment.patient.patient_id }}<br>
                    <strong>Age/Gender:</strong> {{ prescription.appointment.patient.age }} years / {{ prescription.appointment.patient.get_gender_display }}<br>
                    {% if prescription.appointment.patient.blood_group %}
                    <strong>Blood Group:</strong> <span class="badge">{{ prescription.appointment.patient.blood_group }}</span><br>
                    {% endif %}
                    <strong>Phone:</strong> {{ prescription.appointment.patient.phone }}
                </td>
                <td width="50%" style="text-align: right;">
                    <strong>Date:</strong> {{ prescription.created_at|date:"M d, Y" }}<br>
                    <strong>Serial No:</strong> {{ prescription.appointment.serial_number }}<br>
                    <strong>Doctor:</strong> Dr. {{ prescription.appointment.doctor.get_full_name }}<br>
                    <strong>Specialization:</strong> {{ prescription.appointment.doctor.specialization }}
                </td>
            </tr>
        </table>
    </div>
    
    <!-- Allergies Warning -->
    {% if prescription.appointment.patient.allergies %}
    <div class="alert-box">
        <strong>‚ö†Ô∏è ALLERGIES ALERT:</strong> {{ prescription.appointment.patient.allergies }}
    </div>
    {% endif %}
    
    <!-- Diagnosis -->
    <div class="section">
        <div class="section-title">üìã Diagnosis</div>
        <p>{{ prescription.diagnosis }}</p>
    </div>
    
    <!-- Symptoms -->
    {% if prescription.symptoms %}
    <div class="section">
        <div class="section-title">ü©∫ Symptoms</div>
        <p>{{ prescription.symptoms }}</p>
    </div>
    {% endif %}
    
    <!-- Medicines -->
    {% if prescription.medicines.exists %}
    <div class="section">
        <div class="section-title">üíä Prescription</div>
        <table class="medicine-table">
            <thead>
                <tr>
                    <th width="5%">#</th>
                    <th width="30%">Medicine Name</th>
                    <th width="15%">Dosage</th>
                    <th width="15%">Frequency</th>
                    <th width="10%">Duration</th>
                    <th width="25%">Instructions</th>
                </tr>
            </thead>
            <tbody>
                {% for medicine in prescription.medicines.all %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td><strong>{{ medicine.medicine_name }}</strong></td>
                    <td>{{ medicine.dosage }}</td>
                    <td>{{ medicine.frequency }}</td>
                    <td>{{ medicine.duration }}</td>
                    <td>{{ medicine.instructions|default:"-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <!-- Lab Tests -->
    {% if prescription.lab_tests %}
    <div class="section">
        <div class="section-title">üî¨ Lab Tests Recommended</div>
        <ul>
            {% for test in prescription.lab_tests.splitlines %}
            <li>{{ test }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <!-- Follow-up -->
    {% if prescription.follow_up_date %}
    <div class="section">
        <div class="section-title">üìÖ Follow-up</div>
        <p><strong>Next Visit:</strong> {{ prescription.follow_up_date|date:"M d, Y" }}</p>
    </div>
    {% endif %}
    
    <!-- Additional Notes -->
    {% if prescription.notes %}
    <div class="section">
        <div class="section-title">üìù Additional Notes</div>
        <p>{{ prescription.notes }}</p>
    </div>
    {% endif %}
    
    <!-- Doctor Signature -->
    <div class="signature">
        <div style="margin-top: 60px;">
            <div class="signature-line"></div>
            <p style="margin-top: 10px;">
                <strong>Dr. {{ prescription.appointment.doctor.get_full_name }}</strong><br>
                {{ prescription.appointment.doctor.specialization }}<br>
                Reg. No: DOC{{ prescription.appointment.doctor.id|stringformat:"04d" }}<br>
                {{ prescription.appointment.doctor.phone }}
            </p>
        </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
        <p>This is a computer-generated prescription | Printed on {{ prescription.created_at|date:"M d, Y h:i A" }}</p>
        <p>Universal Health Services & Diagnostic Center | Phone: ‡ß¶‡ßß‡ß≠‡ß©‡ß®-‡ßÆ‡ß´‡ß©‡ß©‡ß¶‡ß©</p>
    </div>
    
    <!-- Print Button (hidden when printing) -->
    <div class="no-print" style="position: fixed; top: 20px; right: 20px;">
        <button onclick="window.print()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14pt;">
            üñ®Ô∏è Print
        </button>
        <button onclick="window.close()" style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14pt; margin-left: 10px;">
            ‚úñÔ∏è Close
        </button>
    </div>
    
    <script>
        // Auto-print on page load (optional)
        // window.onload = function() { window.print(); }
    </script>
</body>
</html>
