{% extends 'base.html' %}
{% load static %}

{% block title %}Quality Control - Laboratory{% endblock %}

{% block extra_css %}
<style>
.qc-card{border-radius:12px;padding:20px;box-shadow:0 3px 8px rgba(0,0,0,0.06);}
.metric{font-size:1.6rem;font-weight:700}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row mb-3">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h3><i class="fas fa-vials"></i> Quality Control Dashboard</h3>
      <a href="{% url 'lab:test_list' %}" class="btn btn-outline-primary">Manage Tests</a>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-md-3">
      <div class="qc-card bg-light">
        <div class="text-muted">QC Runs (7d)</div>
        <div class="metric">{{ qc_runs_7d }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="qc-card bg-light">
        <div class="text-muted">Failed Controls</div>
        <div class="metric text-danger">{{ qc_failed }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="qc-card bg-light">
        <div class="text-muted">Instruments Online</div>
        <div class="metric text-success">{{ instruments_online }}</div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="qc-card bg-light">
        <div class="text-muted">Pending QC Actions</div>
        <div class="metric text-warning">{{ qc_pending }}</div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header">Recent QC Logs</div>
        <div class="card-body">
          <ul class="list-group">
            {% for log in recent_qc_logs %}
            <li class="list-group-item d-flex justify-content-between">
              <div>
                <strong>{{ log.test_name }}</strong> - {{ log.outcome }}
                <div><small class="text-muted">{{ log.timestamp|date:'d M, Y h:i A' }} by {{ log.performed_by }}</small></div>
              </div>
              <div>
                {% if log.outcome == 'FAIL' %}<span class="badge bg-danger">FAIL</span>{% else %}<span class="badge bg-success">OK</span>{% endif %}
              </div>
            </li>
            {% empty %}
            <li class="list-group-item">No QC logs</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card">
        <div class="card-header">Action Items</div>
        <div class="card-body">
          <ul class="list-unstyled">
            {% for item in qc_actions %}
            <li class="mb-2">
              <strong>{{ item.title }}</strong>
              <div><small class="text-muted">{{ item.detail }}</small></div>
            </li>
            {% empty %}
            <li>No action items</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}